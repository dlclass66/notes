
# 使用框架

gtest

# gtest

## 断言

断言结果可以是成功 非致命失败（继续执行） 致命失败（直接终止）
gtest断言是类似于函数调用的宏，ASSERT_\*失败时是致命失败（因为直接跳出函数，一些代码没有被执行可能造成内存泄漏引起其它报错） EXPECT_\*是非致命失败
使用<<将附加信息输出到断言中

实例

```cpp
ASSERT_EQ(x.size(), y.size()) << "Vectors x and y are of unequal length";

for (int i = 0; i < x.size(); ++i) {
  EXPECT_EQ(x[i], y[i]) << "Vectors x and y differ at index " << i;
}
```

## 测试函数

使用宏TEST() 其中的断言有失败（致命或非致命）或者测试崩溃 则整个测试失败 否则测试成功
实例

```cpp
TEST(TestSuiteName, TestName) {
  ... test body ...
}
```

TestSuiteName是测试套件（有关的一系列测试）的名称 TestName是测试的名称 两者均不包含下划线

## 测试夹具（test fixtures）

在相似的测试中重用配置
使用TEST_F（）
实例

```cpp
TEST_F(TestFixtureClassName, TestName) {
  ... test body ...
}
```

TestFixtureClassName是夹具类的名称 TestName是测试的名称
首先需要定义夹具类 公有（public）继承自testing::Test 由于需要从子类访问 类中成员使用protect修饰
类中最好有SetUp()函数为每个测试准备对象 TearDown()函数释放对象
每个TEST_F创建的测试是独立的 对对象的修改不会影响其他测试

## RUN_ALL_TESTS()

使用RUN_ALL_TESTS()会自动进行所有 TEST() 和TEST_F()的测试 全部成功返回0 否则返回1 发生致命错误会直接终止整个测试
main() 必须返回RUN_ALL_TESTS() RUN_ALL_TESTS()也只能被调用一次

## 线程安全性

在有pthread库的平台是安全的 比如linux 在windows则不安全

## main函数

返回必须是RUN_ALL_TESTS()
调用前需要用testing::InitGoogleTest()解析gtest flag
大多数时候不需要自己构建main函数 将其与gtest_main链接起来即可